<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>My Profile - ConnectHub Pro</title>
    <link rel="stylesheet" href="../css/main.css">
</head>
<body class="bg-background">
    <!-- Navigation Header -->
    <nav class="bg-white shadow-custom-sm sticky top-0 z-50">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between items-center h-16">
                <!-- Logo -->
                <div class="flex items-center">
                    <svg class="h-10 w-10 text-primary" viewBox="0 0 40 40" fill="currentColor">
                        <circle cx="20" cy="20" r="18" fill="none" stroke="currentColor" stroke-width="2"/>
                        <path d="M12 20h16M20 12v16" stroke="currentColor" stroke-width="2"/>
                        <circle cx="15" cy="15" r="2" fill="currentColor"/>
                        <circle cx="25" cy="25" r="2" fill="currentColor"/>
                    </svg>
                    <span class="ml-3 text-xl font-bold text-primary">ConnectHub Pro</span>
                </div>
                
                <!-- Desktop Navigation -->
                <div class="hidden md:flex items-center space-x-8">
                    <a href="homepage.html" class="text-text-secondary hover:text-primary transition-custom">Home</a>
                    <a href="business_directory.html" class="text-text-secondary hover:text-primary transition-custom">Businesses</a>
                    <a href="professional_network.html" class="text-text-secondary hover:text-primary transition-custom">Professionals</a>
                    <a href="community_dashboard.html" class="text-text-secondary hover:text-primary transition-custom">Dashboard</a>
                    <a href="my_profile.html" class="text-primary font-semibold border-b-2 border-primary pb-1">My Profile</a>
                </div>
                
                <!-- User Menu -->
                <div class="hidden md:block" id="user-menu"></div>
            </div>
        </div>
    </nav>

    <!-- Loading State -->
    <div id="loading-state" class="py-20 text-center">
        <div class="inline-block animate-spin rounded-full h-12 w-12 border-b-2 border-primary"></div>
        <p class="mt-4 text-text-secondary">Loading your profile...</p>
    </div>

    <!-- Profile Content -->
    <div id="profile-content" class="hidden">
        <!-- Profile will be loaded here dynamically -->
    </div>

    <!-- Error State -->
    <div id="error-state" class="hidden max-w-2xl mx-auto px-4 py-20 text-center">
        <svg class="w-16 h-16 text-error mx-auto mb-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"/>
        </svg>
        <h2 class="text-2xl font-bold text-primary mb-4">Profile Not Found</h2>
        <p class="text-text-secondary mb-6">You haven't created your profile yet.</p>
        <a href="profile_creation_wizard.html" class="btn-primary inline-block">Create Your Profile</a>
    </div>

    <!-- Scripts -->
    <script src="../js/utils.js"></script>
    <script src="../js/auth.js"></script>
    <script src="../js/main.js"></script>
    <script>
        // Load user's profile
        document.addEventListener('DOMContentLoaded', async function() {
            const loadingState = document.getElementById('loading-state');
            const profileContent = document.getElementById('profile-content');
            const errorState = document.getElementById('error-state');
            
            // Check if user is logged in
            const token = localStorage.getItem('auth_token');
            const userData = JSON.parse(localStorage.getItem('user_data') || 'null');
            
            if (!token || !userData) {
                window.location.href = 'homepage.html';
                return;
            }
            
            try {
                // Fetch user's profile
                const endpoint = userData.userType === 'business' 
                    ? `http://localhost:3000/api/profiles/business/user/${userData.id}`
                    : `http://localhost:3000/api/profiles/professional/user/${userData.id}`;
                
                const response = await fetch(endpoint, {
                    headers: {
                        'Authorization': `Bearer ${token}`
                    }
                });
                
                const result = await response.json();
                
                if (result.success && result.data) {
                    // Hide loading, show profile
                    loadingState.classList.add('hidden');
                    profileContent.classList.remove('hidden');
                    
                    // Render profile based on type
                    if (userData.userType === 'business') {
                        renderBusinessProfile(result.data);
                    } else {
                        renderProfessionalProfile(result.data);
                    }
                } else {
                    // Profile doesn't exist yet
                    loadingState.classList.add('hidden');
                    errorState.classList.remove('hidden');
                }
            } catch (error) {
                console.error('Error loading profile:', error);
                loadingState.classList.add('hidden');
                errorState.classList.remove('hidden');
            }
        });
        
        function renderBusinessProfile(profile) {
            const content = document.getElementById('profile-content');
            content.innerHTML = `
                <div class="max-w-5xl mx-auto px-4 py-12">
                    <!-- Header -->
                    <div class="bg-white rounded-2xl shadow-custom-lg overflow-hidden mb-8">
                        <div class="h-48 bg-gradient-to-r from-primary to-accent"></div>
                        <div class="px-8 pb-8">
                            <div class="flex flex-col md:flex-row items-start md:items-end gap-6 -mt-16">
                                <div class="w-32 h-32 rounded-2xl bg-white border-4 border-white shadow-custom-lg overflow-hidden">
                                    <img src="${profile.logo_url || 'https://via.placeholder.com/150'}" 
                                         alt="${profile.business_name}" 
                                         class="w-full h-full object-cover">
                                </div>
                                <div class="flex-1">
                                    <h1 class="text-3xl font-bold text-primary mb-2">${profile.business_name}</h1>
                                    <p class="text-lg text-text-secondary mb-4">${profile.tagline || ''}</p>
                                    <div class="flex flex-wrap gap-3">
                                        <span class="px-4 py-2 bg-primary-100 text-primary rounded-full text-sm font-medium">${profile.category || 'Business'}</span>
                                        ${profile.is_verified ? '<span class="px-4 py-2 bg-success-100 text-success rounded-full text-sm font-medium">âœ“ Verified</span>' : ''}
                                    </div>
                                </div>
                                <a href="profile_creation_wizard.html?type=business" class="btn-primary">Edit Profile</a>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Info Grid -->
                    <div class="grid md:grid-cols-3 gap-8">
                        <!-- Main Content -->
                        <div class="md:col-span-2 space-y-8">
                            <!-- About -->
                            <div class="card">
                                <h2 class="text-2xl font-semibold text-primary mb-4">About</h2>
                                <p class="text-text-secondary whitespace-pre-wrap">${profile.description || 'No description provided.'}</p>
                            </div>
                            
                            <!-- Services -->
                            ${profile.services && profile.services.length > 0 ? `
                            <div class="card">
                                <h2 class="text-2xl font-semibold text-primary mb-4">Services</h2>
                                <div class="flex flex-wrap gap-3">
                                    ${profile.services.map(service => `
                                        <span class="px-4 py-2 bg-surface rounded-lg text-text-primary">${service}</span>
                                    `).join('')}
                                </div>
                            </div>
                            ` : ''}
                        </div>
                        
                        <!-- Sidebar -->
                        <div class="space-y-6">
                            <!-- Contact Info -->
                            <div class="card">
                                <h3 class="text-lg font-semibold text-primary mb-4">Contact Info</h3>
                                <div class="space-y-3">
                                    ${profile.email ? `
                                    <div class="flex items-center text-text-secondary">
                                        <svg class="w-5 h-5 mr-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 8l7.89 5.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"/>
                                        </svg>
                                        ${profile.email}
                                    </div>
                                    ` : ''}
                                    ${profile.phone ? `
                                    <div class="flex items-center text-text-secondary">
                                        <svg class="w-5 h-5 mr-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 5a2 2 0 012-2h3.28a1 1 0 01.948.684l1.498 4.493a1 1 0 01-.502 1.21l-2.257 1.13a11.042 11.042 0 005.516 5.516l1.13-2.257a1 1 0 011.21-.502l4.493 1.498a1 1 0 01.684.949V19a2 2 0 01-2 2h-1C9.716 21 3 14.284 3 6V5z"/>
                                        </svg>
                                        ${profile.phone}
                                    </div>
                                    ` : ''}
                                    ${profile.website ? `
                                    <div class="flex items-center text-text-secondary">
                                        <svg class="w-5 h-5 mr-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 12a9 9 0 01-9 9m9-9a9 9 0 00-9-9m9 9H3m9 9a9 9 0 01-9-9m9 9c1.657 0 3-4.03 3-9s-1.343-9-3-9m0 18c-1.657 0-3-4.03-3-9s1.343-9 3-9m-9 9a9 9 0 019-9"/>
                                        </svg>
                                        <a href="${profile.website}" target="_blank" class="text-primary hover:text-primary-600">${profile.website}</a>
                                    </div>
                                    ` : ''}
                                    ${profile.address ? `
                                    <div class="flex items-center text-text-secondary">
                                        <svg class="w-5 h-5 mr-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z"/>
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 11a3 3 0 11-6 0 3 3 0 016 0z"/>
                                        </svg>
                                        ${profile.address}
                                    </div>
                                    ` : ''}
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            `;
        }
        
        function renderProfessionalProfile(profile) {
            const content = document.getElementById('profile-content');
            content.innerHTML = `
                <div class="max-w-5xl mx-auto px-4 py-12">
                    <!-- Header -->
                    <div class="bg-white rounded-2xl shadow-custom-lg overflow-hidden mb-8">
                        <div class="h-48 bg-gradient-to-r from-primary to-accent"></div>
                        <div class="px-8 pb-8">
                            <div class="flex flex-col md:flex-row items-start md:items-end gap-6 -mt-16">
                                <div class="w-32 h-32 rounded-full bg-white border-4 border-white shadow-custom-lg overflow-hidden">
                                    <img src="${profile.profile_image_url || 'https://via.placeholder.com/150'}" 
                                         alt="${profile.first_name} ${profile.last_name}" 
                                         class="w-full h-full object-cover">
                                </div>
                                <div class="flex-1">
                                    <h1 class="text-3xl font-bold text-primary mb-2">${profile.first_name} ${profile.last_name}</h1>
                                    <p class="text-lg text-accent font-medium mb-4">${profile.title || 'Professional'}</p>
                                    ${profile.location ? `<p class="text-text-secondary">${profile.location}</p>` : ''}
                                </div>
                                <a href="profile_creation_wizard.html?type=professional" class="btn-primary">Edit Profile</a>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Info Grid -->
                    <div class="grid md:grid-cols-3 gap-8">
                        <!-- Main Content -->
                        <div class="md:col-span-2 space-y-8">
                            <!-- About -->
                            <div class="card">
                                <h2 class="text-2xl font-semibold text-primary mb-4">About</h2>
                                <p class="text-text-secondary whitespace-pre-wrap">${profile.bio || 'No bio provided.'}</p>
                            </div>
                            
                            <!-- Skills -->
                            ${profile.skills && profile.skills.length > 0 ? `
                            <div class="card">
                                <h2 class="text-2xl font-semibold text-primary mb-4">Skills</h2>
                                <div class="flex flex-wrap gap-3">
                                    ${profile.skills.map(skill => `
                                        <span class="px-4 py-2 bg-primary-100 text-primary rounded-lg font-medium">${skill}</span>
                                    `).join('')}
                                </div>
                            </div>
                            ` : ''}
                        </div>
                        
                        <!-- Sidebar -->
                        <div class="space-y-6">
                            <!-- Contact Info -->
                            <div class="card">
                                <h3 class="text-lg font-semibold text-primary mb-4">Contact Info</h3>
                                <div class="space-y-3">
                                    ${profile.email ? `
                                    <div class="flex items-center text-text-secondary">
                                        <svg class="w-5 h-5 mr-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 8l7.89 5.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"/>
                                        </svg>
                                        ${profile.email}
                                    </div>
                                    ` : ''}
                                    ${profile.phone ? `
                                    <div class="flex items-center text-text-secondary">
                                        <svg class="w-5 h-5 mr-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 5a2 2 0 012-2h3.28a1 1 0 01.948.684l1.498 4.493a1 1 0 01-.502 1.21l-2.257 1.13a11.042 11.042 0 005.516 5.516l1.13-2.257a1 1 0 011.21-.502l4.493 1.498a1 1 0 01.684.949V19a2 2 0 01-2 2h-1C9.716 21 3 14.284 3 6V5z"/>
                                        </svg>
                                        ${profile.phone}
                                    </div>
                                    ` : ''}
                                    ${profile.linkedin_url ? `
                                    <div class="flex items-center text-text-secondary">
                                        <svg class="w-5 h-5 mr-3" fill="currentColor" viewBox="0 0 24 24">
                                            <path d="M20.447 20.452h-3.554v-5.569c0-1.328-.027-3.037-1.852-3.037-1.853 0-2.136 1.445-2.136 2.939v5.667H9.351V9h3.414v1.561h.046c.477-.9 1.637-1.85 3.37-1.85 3.601 0 4.267 2.37 4.267 5.455v6.286zM5.337 7.433c-1.144 0-2.063-.926-2.063-2.065 0-1.138.92-2.063 2.063-2.063 1.14 0 2.064.925 2.064 2.063 0 1.139-.925 2.065-2.064 2.065zm1.782 13.019H3.555V9h3.564v11.452zM22.225 0H1.771C.792 0 0 .774 0 1.729v20.542C0 23.227.792 24 1.771 24h20.451C23.2 24 24 23.227 24 22.271V1.729C24 .774 23.2 0 22.222 0h.003z"/>
                                        </svg>
                                        <a href="${profile.linkedin_url}" target="_blank" class="text-primary hover:text-primary-600">LinkedIn</a>
                                    </div>
                                    ` : ''}
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            `;
        }
    </script>
</body>
</html>

